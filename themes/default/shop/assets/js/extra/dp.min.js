var ajax_submit_form_callback = function(){
    console.log('default_call_back');
};
const loader = '<div align="center" id="page_preloader" style="padding:50px"><div class="green_preloader"></div></div>';
const unknow_image = base_url+'upload/images/empty_box.png';
var init_date_picker;
var init_datatable;
swallTowAutoClose = true;

$(document).ready(function(){
    //alter default adminlte icon with site icon
    // $('[rel="icon"],[rel="shortcut icon"]').attr('href',base_url+'assets/images/favicon.png');
    // $('[rel="icon"],[rel="shortcut icon"]').attr('type','image/x-icon');
    $('#page_preloader').remove();

    $('[class="active"]').removeClass('active');

    $('a[href="'+location.origin+location.pathname+'"]').parent().addClass('active');

    $('a[onclick="location.href=\''+location.origin+location.pathname+'\'"]').parent().parent().parent().addClass('active');

    $('a[onclick="location.href=\''+location.origin+location.pathname+'\'"]').addClass('btn-secondary');

    if ($('#password').length) {
        var options = {};
        options.ui = {
            container: '#pwd-container',
            showVerdictsInsideProgressBar: true,
            viewports: {
                progress: '.pwstrength_viewport_progress'
            }
        };
        options.common = {
            debug: false,
            onLoad: function() {
                $('#messages').text('Start typing password');
            }
        };
        $('#password').pwstrength(options);
    }

    if ($('#group_bgcolor').length){
        var elem = $('#group_bgcolor');

        elem.ColorPickerSliders({
            size: 'lg',
            placement: 'auto bottom',
            previewformat: 'hex',
            color: elem.attr('data-src'),
            swatches: ['#F44336', '#E91E63', '#9C27B0', '#673AB7', '#3F51B5', '#2196F3', '#009688', '#FF5722', '#795548', '#607D8B', '#000000'],
            customswatches: false,
            order: {}
        });

        $('button[type="reset"]').on('click', function(e){
            elem.trigger('colorpickersliders.updateColor', elem.attr('data-src'));
        });
    }

    init_datatable = function(table_id){
        table_id = table_id || '#zero_config , #dtBasicExample , #datatable , #basic-datatable';
        let datatable_elemt = $(table_id);
        let datatable = $(datatable_elemt);
        if(typeof datatable.html() !== 'undefined'){
            if(!has_attr(datatable_elemt,'data-page-length')){
                $(datatable_elemt).attr('data-page-length','50');
            }
            if(!has_attr(datatable_elemt,'width')){
                $(datatable_elemt).attr('width','100%');
            }

            if(!datatable_elemt.hasClass('table-hover')){
                $(datatable_elemt).addClass('table-hover');
            }

            let table_head = $('#zero_config thead, #dtBasicExample thead, #datatable thead');



            datatable_elemt.DataTable({
                "searching": true ,// false to disable search (or any other option)
                "scrollX": true,
                "scrollY": false,
                "language":
                    {
                        "sSearch":         "<i class='fas fa-search'></i>",
                        "sLengthMenu":     "<i class='mdi mdi-eye'></i> _MENU_",
                    }

            });
        }
        $('.dataTables_length').addClass('bs-select');
    };
    init_datatable();

    init_date_picker  = function(){
        let datepicker_tags = $('.datepicker-here');
        let datepicker_range_tags = $('.datepicker-range-here');
        let datepicker_calendar_tags = $('.datepicker-calendar-here');

        if(datepicker_tags.length>0){
            for(var i = 0; i<datepicker_tags.length; i++){
                var datepicker_tag = $(datepicker_tags[i]);
                //set max date to actual date
                if(!datepicker_tag.hasClass('allow-all-date') && !datepicker_tag.hasClass('future-date-only')){
                    datepicker_tag.datepicker({maxDate: new Date(),autoClose:true});
                }

                if(datepicker_tag.hasClass('future-date-only')){
                    datepicker_tag.datepicker({minDate: new Date(),autoClose:true });
                }

                if(datepicker_tag.hasClass('allow-all-date')){
                    datepicker_tag.datepicker({autoClose:true});
                }
            }
        }

        if(datepicker_range_tags.length > 0){
            for(var u = 0; u<datepicker_range_tags.length ; u++){
                var datepicker_range_tag = $(datepicker_range_tags[u]);
                //set max date to actual date
                if(!datepicker_range_tag.hasClass('allow-all-date') && !datepicker_range_tag.hasClass('future-date-only')){
                    datepicker_range_tag.datepicker({maxDate: new Date(),range:true,inline:false , autoClose:true});
                }
                if(datepicker_range_tag.hasClass('future-date-only')){
                    var autoclose = datepicker_range_tag.attr('data-autoclose') || true;
                    if(has_attr(datepicker_range_tag , 'data-autoclose')){autoclose = (autoclose === 'true')}

                    var option = {
                        minDate: new Date(),
                        range: true,
                        inline: false,
                        autoClose: autoclose,
                    }
                    datepicker_range_tag.datepicker(option);
                }

                if(datepicker_range_tag.hasClass('allow-all-date')){
                    datepicker_range_tag.datepicker({range:true,inline:false , autoClose:true});
                }
            }

        }

        if(datepicker_calendar_tags.length > 0){
            for(var v = 0 ; v<datepicker_calendar_tags.length ; datepicker_calendar_tags++){
                var datepicker_calendar_tag = $(datepicker_calendar_tags[v]);
                datepicker_calendar_tag.datepicker({inline:true});
            }
        }
    };

    init_date_picker();

    if(typeof upload !== 'undefined' || typeof upload2 !== 'undefined'){
        default_preview_background = 'background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiQAAAD6CAMAAACmhqw0AAAA+VBMVEUAAAD29u3u7unt7ent7enu7uju7uihoqCio6Gio6KjpKOkpaSmpqSmp6WoqKaqq6mqq6qrq6qsrautrauur62wsa6xsa+xsrCys7GztLK0tbK1trS2t7S3t7W4uba5ure6u7e7vLm8vbu9vrvAwL3Awb3DxMHFxcPGxsPHx8TIycXLzMjLzMnMzMnNzsrPz8vP0MzQ0M3S0s/U1NDV1dLX19TY2NTY2NXZ2dba2tXb29bc3Nfc3Njc3dnd3dre3tre39vg4Nvh4dzi4t3i4t7j497k5N/k5ODl5eDl5eHl5uLm5uHn5+Lo6OPp6eTq6uXr6+bs7Oft7eh54KxIAAAAB3RSTlMAHKbl5uztvql9swAABA1JREFUeNrt3VlT01AYgOG0oEEE910URNzFBVFcqCgKirLU/P8fI3QYbEOSdtrMyJzzvHfMlFx833NBQuY0SRrN8UwqabzZSJLGaYNQVacaSdMUVF0zGTMEVTeWmIH6BYkgESSCRJAIEkEiSCRIBIkgESSCRJAIEkEiQSJIBIkgESSCRJAIEgkSQSJIBIkgESSCRJBIkAgSQSJIBIkgESSCRIJEkAgSQSJIBIkgkSARJIJEkAgSQSJIBIkEiSARJIJEkAgSQSJIJEgEiSARJIJEkAgSQSJBIkgEiSARJIJEkAgSCRJBIkgEiSARJIJEgkSQ5PvxbdS+tyEJuZVb0+noTV579geSQGs/SOvqxiYkYfYwra+rbUhC7NNEjUjSJ5CE2P06jaTnIAmxKwe7vb468t3N14WOki1IAuzMwWrf1HCh3Q6S95AEWGe1b0/WlSCBBBJIIAkdSXvt1aNXa21IICld7dJU5+epJUggKV7tzuzRA4/ZHUggKVrtfNdjsXlIIClY7XLPw9NlSCA5vtqLPUguQgLJsdX+zv0fZhsSSPKrXckhWSn5jV8zG5DEiuR1DsnrEiOX0vMbkESKZDWHZLXMSFqsBJIIkOz1vn40sVdqpFgJJDHc3dzsQXKzwkihEkhiQLI+2f3y+3qVkSIlkMSAJFvsQrJYbaRACSRRIMlenj0UcPZlPyPHlUASB5Jsc+7cwevMc5v9jRxTAkkkSPbb+riVZYMYySuBJB4kJRUYySmBJHYkhUZ6lUASOZISIz1KIIkbSamRbiWQxIZkvT2YkS4lkESGpDV9tz2YkX9KIIkLSWs6TY+U9DFypASSqJC0OicfHSrpa2T/k5BEh6R1eDpWR8kARtIZSGJD0jo6QW1fySBGIIkOSavrlL27PwcxAklsSFo9JzFOppBAkl9ta5jTOiGJCslQRiCJCslwRiCJCcmQRiCJCMmwRiCJB8mXoU+YhyQaJM9TSCCBBBJIIIEEEkgggQQSSCCJAsnyzLA9hiQWJCfnSpBAAgkkkATXxFCnPxfU7iB5B0mAXT5Y7Z3t0Y087SDZgCTA7tX6bZ5TGSQBtlwrkgVIgmy+RiMXdiEJsp3b9Rn5nEESaC/O1/P3yMJuBkm4bX94O2rvNiKbWXRIBIkgESSCRJAIEkEiQSJIBIkgESSCRJAIEgkSQSJIBIkgESSCRIJEkAgSQSJIBIkgESQSJIJEkAgSQSJIBIkgkSARJIJEkAgSQSJIBIkEiSARJIJEkAgSQSJIJEgEiSARJIJEkAgSCRJBIkgEiSARJIJEkEiQCBJBIkgEiSARJIJEgkSQCBJBIkgEiSARJBIkgkSQ6P8gGTMDVTeWNA1B1TWTxmlTUFWnGknSaI4bhMoabzaSv+4BHFVoHZzfAAAAAElFTkSuQmCC")';
        active_upload_id = null;
        active_upload = null;
    }

    if(typeof upload !== 'undefined' || typeof upload2 !== 'undefined'){
        default_preview_background = 'background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAiQAAAD6CAMAAACmhqw0AAAA+VBMVEUAAAD29u3u7unt7ent7enu7uju7uihoqCio6Gio6KjpKOkpaSmpqSmp6WoqKaqq6mqq6qrq6qsrautrauur62wsa6xsa+xsrCys7GztLK0tbK1trS2t7S3t7W4uba5ure6u7e7vLm8vbu9vrvAwL3Awb3DxMHFxcPGxsPHx8TIycXLzMjLzMnMzMnNzsrPz8vP0MzQ0M3S0s/U1NDV1dLX19TY2NTY2NXZ2dba2tXb29bc3Nfc3Njc3dnd3dre3tre39vg4Nvh4dzi4t3i4t7j497k5N/k5ODl5eDl5eHl5uLm5uHn5+Lo6OPp6eTq6uXr6+bs7Oft7eh54KxIAAAAB3RSTlMAHKbl5uztvql9swAABA1JREFUeNrt3VlT01AYgOG0oEEE910URNzFBVFcqCgKirLU/P8fI3QYbEOSdtrMyJzzvHfMlFx833NBQuY0SRrN8UwqabzZSJLGaYNQVacaSdMUVF0zGTMEVTeWmIH6BYkgESSCRJAIEkEiSCRIBIkgESSCRJAIEkEiQSJIBIkgESSCRJAIEgkSQSJIBIkgESSCRJBIkAgSQSJIBIkgESSCRIJEkAgSQSJIBIkgkSARJIJEkAgSQSJIBIkEiSARJIJEkAgSQSJIJEgEiSARJIJEkAgSQSJBIkgEiSARJIJEkAgSCRJBIkgEiSARJIJEgkSQ5PvxbdS+tyEJuZVb0+noTV579geSQGs/SOvqxiYkYfYwra+rbUhC7NNEjUjSJ5CE2P06jaTnIAmxKwe7vb468t3N14WOki1IAuzMwWrf1HCh3Q6S95AEWGe1b0/WlSCBBBJIIAkdSXvt1aNXa21IICld7dJU5+epJUggKV7tzuzRA4/ZHUggKVrtfNdjsXlIIClY7XLPw9NlSCA5vtqLPUguQgLJsdX+zv0fZhsSSPKrXckhWSn5jV8zG5DEiuR1DsnrEiOX0vMbkESKZDWHZLXMSFqsBJIIkOz1vn40sVdqpFgJJDHc3dzsQXKzwkihEkhiQLI+2f3y+3qVkSIlkMSAJFvsQrJYbaRACSRRIMlenj0UcPZlPyPHlUASB5Jsc+7cwevMc5v9jRxTAkkkSPbb+riVZYMYySuBJB4kJRUYySmBJHYkhUZ6lUASOZISIz1KIIkbSamRbiWQxIZkvT2YkS4lkESGpDV9tz2YkX9KIIkLSWs6TY+U9DFypASSqJC0OicfHSrpa2T/k5BEh6R1eDpWR8kARtIZSGJD0jo6QW1fySBGIIkOSavrlL27PwcxAklsSFo9JzFOppBAkl9ta5jTOiGJCslQRiCJCslwRiCJCcmQRiCJCMmwRiCJB8mXoU+YhyQaJM9TSCCBBBJIIIEEEkgggQQSSCCJAsnyzLA9hiQWJCfnSpBAAgkkkATXxFCnPxfU7iB5B0mAXT5Y7Z3t0Y087SDZgCTA7tX6bZ5TGSQBtlwrkgVIgmy+RiMXdiEJsp3b9Rn5nEESaC/O1/P3yMJuBkm4bX94O2rvNiKbWXRIBIkgESSCRJAIEkEiQSJIBIkgESSCRJAIEgkSQSJIBIkgESSCRIJEkAgSQSJIBIkgESQSJIJEkAgSQSJIBIkgkSARJIJEkAgSQSJIBIkEiSARJIJEkAgSQSJIJEgEiSARJIJEkAgSCRJBIkgEiSARJIJEkEiQCBJBIkgEiSARJIJEgkSQCBJBIkgEiSARJBIkgkSQ6P8gGTMDVTeWNA1B1TWTxmlTUFWnGknSaI4bhMoabzaSv+4BHFVoHZzfAAAAAElFTkSuQmCC")';
        active_upload_id = null;
        active_upload = null;
    }

    let error_message   = get_flashdata('error_message');
    let info_message    = get_flashdata('info_message');
    let success_message = get_flashdata('success_message');
    let warning_message = get_flashdata('warning_message');

    if(warning_message !== null){show_message('warning',warning_message)}
    if(error_message !== null){show_message('error',error_message)}
    if(info_message !== null){show_message('info',info_message)}
    if(success_message !== null){show_message('success',success_message)}

    init_image_boxes();
    init_select2();
    
});

$(document).on('click','[href="'+base_url+'auth/logout/admin"],[href="'+base_url+'auth/logout"]',{passive:true},function () {
    localStorage.setItem('set_deauth_notification','true');
});
$(document).on('click','*[disabled]',function () { show_message('error','Option was disabed for security measure!'); });
$(document).on('keyup','[type="email"]',{passive:true},function () {
    $('#'+$(this).attr('name')+'_email_err_msg').remove();
    var err_email_msg = '<small class="text-danger '+(($(this).hasClass('hide-error'))?'dis-none':'dis-block')+'" id="'+$(this).attr('name')+'_email_err_msg">Invalid email address</small>';
    console.log(validateEmail(this.value))
    if(validateEmail(this.value)){
        $(this).removeClass('is-invalid');
        $(this).addClass('is-valid');
        $('#'+$(this).attr('name')+'_email_err_msg').remove();
    }
    else{
        $(this).removeClass('is-valid');
        $(this).addClass('is-invalid');
        $(this).after(err_email_msg);
    }
});
$(document).on('blur keyup','*[required]',{passive:true},function () {
    if(!$(this).hasClass('ignore_error')){
        $('#'+$(this).attr('name')+'_req_err_msg').remove();
        var error_req_msg = '<small class="text-danger '+(($(this).hasClass('hide-error'))?'dis-none':'dis-block')+'" id="'+$(this).attr('name')+'_req_err_msg">This field is required</small>';
        if($(this).val().trim().length>0){
            $(this).removeClass('is-invalid');
            $(this).addClass('is-valid');
            $('#'+$(this).attr('name')+'_req_err_msg').remove();
        }
        else{
            $(this).removeClass('is-valid');
            $(this).addClass('is-invalid');
            $(this).val('');
            $(this).after(error_req_msg);
        }
    }

});
$(document).on('keyup blur','input[min], input[max] ,textarea[max]',function () {
    if($(this).attr('type')!== 'number' && $(this).attr('type') !== 'range'){
        let tag = $(this);
        let tag_id = get_id(this);
        let display = (($(this).hasClass('hide-error'))?'dis-none':'dis-block')
        //has min but not max
        if(has_attr(this,'min') && !has_attr(this,'max')){
            console.log('has min but not max');
            let min_length = $(this).attr('min');
            let msg_tag = $('#mcmsg_'+tag_id+'');
            msg_tag.remove();

            if($(this).val().length<min_length){
                let min_char_msg = '<small class="text-danger '+display+'" id="mcmsg_'+tag_id+'">Should be at least '+min_length+' '+(($(tag).attr('type') != 'number')?'character':'')+''+((min_length>1)?'s':'')+'</small>';
                $(this).removeClass('is-valid');
                $(this).addClass('is-invalid');
                $(this).after(min_char_msg);
            }
            else{
                $(this).removeClass('is-invalid');
                $(this).addClass('is-valid');
                msg_tag.remove();
            }
        }
        //has max but not min
        else if(!has_attr(this,'min') && has_attr(this,'max')){
            console.log('has max but not min');

            let max_length = $(this).attr('max');
            let msg_tag = $('#macmsg_'+tag_id+'');
            msg_tag.remove();

            if($(this).val().length>max_length){
                let max_char_msg = '<small class="text-danger '+display+'" id="macmsg_'+tag_id+'">Should be at most '+max_length+' '+(($(tag).attr('type') != 'number')?'character':'')+''+((max_length>1)?'s':'')+'</small>';
                $(this).removeClass('is-valid');
                $(this).addClass('is-invalid');
                $(this).after(max_char_msg);
            }
            else{
                $(this).removeClass('is-invalid');
                $(this).addClass('is-valid');
                msg_tag.remove();
            }
        }
        // has min , has max
        else{
            let min_length = $(this).attr('min');
            let max_length = $(this).attr('max');
            //exactly
            if(min_length===max_length){
                console.log('exact');
                let msg_tag = $('#excmsg_'+tag_id+'');
                msg_tag.remove();
                if($(this).val().length>max_length || $(this).val().length<min_length){
                    ex_char_msg = '<small class="text-danger '+display+'" id="excmsg_'+tag_id+'">Should be exactly '+max_length+' '+(($(tag).attr('type') != 'number')?'character':'')+''+((max_length>1)?'s':'')+'</small>';
                    $(this).removeClass('is-valid');
                    $(this).addClass('is-invalid');
                    $(this).after(ex_char_msg);
                }
                else{
                    $(this).removeClass('is-invalid');
                    $(this).addClass('is-valid');
                    msg_tag.remove();
                }

            }

            //between
            else{
                // console.log('between : '+min_length+' and '+max_length);
                let msg_tag = $('#betcmsg_'+tag_id+'');
                let remain_msg_tag = $('#remain_char_msg_'+tag_id+'');

                var remaining_tag = parseInt(max_length) - parseInt($(this).val().length);
                msg_tag.remove();
                remain_msg_tag.remove();
                if($(this).val().length<min_length || $(this).val().length>max_length)
                {
                    let bet_char_msg = '<small class="text-danger '+display+'" id="betcmsg_'+tag_id+'">Should be between '+min_length+' and '+max_length+' '+(($(tag).attr('type') != 'number')?'character':'')+''+((max_length>1)?'s':'')+'</small>';
                    $(this).removeClass('is-valid');
                    $(this).addClass('is-invalid');
                    $(this).after(bet_char_msg);
                    remain_msg_tag.remove();
                }
                else{
                    let remaining_char_msg = '<small class="text-success text-right '+display+'" id="remain_char_msg_'+tag_id+'">'+remaining_tag+'</small>';

                    $(this).removeClass('is-invalid');
                    $(this).addClass('is-valid');
                    $(this).after(remaining_char_msg);
                    msg_tag.remove();
                }

            }
        }
    }
});
$(document).on('keyup blur','input[min], input[max]',function () {
    if($(this).attr('type') == 'number'){
        let tag = $(this);
        let tag_id = get_id(this);
        let value = $(this).val();

        value = ((value.length > 0)?value : 0);
        let display = (($(this).hasClass('hide-error'))?'dis-none':'dis-block');
        //has min but not max
        if(has_attr(this,'min') && !has_attr(this,'max')){
            console.log('has min but not max');
            let min_length = $(this).attr('min');
            let msg_tag = $('#mcmsg_'+tag_id+'');
            msg_tag.remove();

            if(parseFloat(value)<min_length){
                let min_char_msg = '<small class="text-danger '+display+'" id="mcmsg_'+tag_id+'">Should be at least '+min_length+'</small>';
                $(this).removeClass('is-valid');
                $(this).addClass('is-invalid');
                $(this).after(min_char_msg);
            }
            else{
                $(this).removeClass('is-invalid');
                $(this).addClass('is-valid');
                msg_tag.remove();
            }
        }
        //has max but not min
        else if(!has_attr(this,'min') && has_attr(this,'max')){
            console.log('has max but not min');

            let max_length = $(this).attr('max');
            let msg_tag = $('#macmsg_'+tag_id+'');
            msg_tag.remove();

            if(parseFloat(value)>max_length){
                let max_char_msg = '<small class="text-danger '+display+'" id="macmsg_'+tag_id+'">Should be at most '+max_length+'</small>';
                $(this).removeClass('is-valid');
                $(this).addClass('is-invalid');
                $(this).after(max_char_msg);
            }
            else{
                $(this).removeClass('is-invalid');
                $(this).addClass('is-valid');
                msg_tag.remove();
            }
        }
        // has min , has max
        else{
            let min_length = $(this).attr('min');
            let max_length = $(this).attr('max');
            //exactly
            if(min_length===max_length){
                console.log('exact');
                let msg_tag = $('#excmsg_'+tag_id+'');
                msg_tag.remove();
                if(parseFloat(value)>max_length || parseFloat(value)<min_length){
                    ex_char_msg = '<small class="text-danger '+display+'" id="excmsg_'+tag_id+'">Should be exactly '+max_length+'</small>';
                    $(this).removeClass('is-valid');
                    $(this).addClass('is-invalid');
                    $(this).after(ex_char_msg);
                }
                else{
                    $(this).removeClass('is-invalid');
                    $(this).addClass('is-valid');
                    msg_tag.remove();
                }

            }

            //between
            else{
                // console.log('between : '+min_length+' and '+max_length);
                let msg_tag = $('#betcmsg_'+tag_id+'');
                let remain_msg_tag = $('#remain_char_msg_'+tag_id+'');

                var remaining_tag = parseInt(max_length) - parseInt(value);
                msg_tag.remove();
                remain_msg_tag.remove();
                if(parseFloat(value)<min_length || parseFloat(value)>max_length)
                {
                    let bet_char_msg = '<small class="text-danger '+display+'" id="betcmsg_'+tag_id+'">Should be between '+min_length+' and '+max_length+'</small>';
                    $(this).removeClass('is-valid');
                    $(this).addClass('is-invalid');
                    $(this).after(bet_char_msg);
                    remain_msg_tag.remove();
                }
                else{
                    let remaining_char_msg = '<small class="text-success text-right '+display+'" id="remain_char_msg_'+tag_id+'">'+remaining_tag+'</small>';

                    $(this).removeClass('is-invalid');
                    $(this).addClass('is-valid');
                    $(this).after(remaining_char_msg);
                    msg_tag.remove();
                }

            }
        }
    }
});
$(document).on('click','#browse-file',{passive:true},function () {
    console.log('select image using button');
    browse_upload_file($(this).parent().parent().attr('data-upload-id'));
});
$(document).on('click','#preview_area , #preview_area2',{passive:true},function () {
    console.log('select image using preview area');
    browse_upload_file($(this).parent().attr('data-upload-id'));
});
$(document).on('click','.custom-file-container__image-clear',function () {
   setTimeout(function () {
       if(upload.selectedFilesCount === 0)
       {
          $('#preview_area').attr('style',default_preview_background);
       }
   },100)
});
$(document).on('click','.close_swal2',{passive:true},function () {
    swal.close();
});
$(document).on('submit','.ajax-form , .ajax_form',{passive:true},function (e) {
    e.preventDefault();
    const form = $(this);
    ajaxSubmit(e, form , ajax_submit_form_callback);
});
$(document).on('click','.upload_image',{passive:true},function () {
    const action_url = $(this).attr('data-action');
    const img_target = $($(this).attr('data-img-target'));
    const img_src = $(img_target).attr('src');
    show_file_chooser(action_url,{img_src:img_src , uploadBtnTitle:'Choisir un fichier'});
});
$(document).on('click','.scroll_to',{passive:true},function () {
    const area = $(this).attr('data-area');
    scrool_to(area);
});

/*=======================================================================================
* DATEPICKER NORMAL AND DATEPICKER RANGE CUSTOM FUNCTION
*=========================================================================================
*/
let dpOpct = 1;
function hide_by_time(){
    dpOpct-=0.1;
    delay = setTimeout('hide_by_time()',50);

    $('#datepickers-container').attr('style','opacity:'+dpOpct+'');

    if(dpOpct<=0){
        clearTimeout(delay);
        $('#datepickers-container').hide();
    }


}
$(document).on('click','.datepicker--cell-old',function(){
    let selected_date = $('.-selected-.-focus-');
    //when using range date
    if(selected_date.hasClass('-range-from-') || selected_date.hasClass('-range-to-')){
        //if the using range date and selected second date
        if(selected_date.hasClass('-range-to-') ){
            hide_by_time();
        }
    }
    //when using normal date
    else{
        console.log('no range');
        hide_by_time()
    }


    let tag = $('.datepicker-here');
    if(tag.val().length>0){
        tag.removeClass('is-invalid');
        tag.addClass('is-valid');
        $('.datepicker-here + .text-danger').remove();
        $(tag).keyup();
    }


});
$(document).on('click','.datepicker-here-old, .datepicker-range-here',{passive:true},function () {
    $('#datepickers-container').attr('style','');
    $('#datepickers-container').show('fast');
    dpOpct = 1
});

function browse_upload_file(upload_id){
    if(typeof upload_id != 'undefined'){
        if(typeof upload !== 'undefined'){
            if(upload.uploadId === upload_id){
                upload.selectImage();
                active_upload_id = upload.uploadId;
                active_upload = upload;
            }

        }
        if(typeof upload2!== 'undefined'){
            if(upload2.uploadId === upload_id){
                upload2.selectImage();
                active_upload_id = upload2.uploadId;
                active_upload = upload2;
            }

        }
    }
}
function has_attr(obj,attrib){
    var attr_val = $(obj).attr(attrib);
    return (typeof  attr_val !== 'undefined')
}
function is_array(v){
    return typeof v === 'object' && typeof v[0] !== 'undefined'
}
function get_form_input(form_id){
    const form = new FormData(document.getElementById(form_id));
    var form_data = {};
    form.forEach(function (value,key) {
        if(form_data[key] === undefined){
            form_data[key] = value;
            //console.log(key+':'+value+'\n');
        }
        else{
            if(typeof form_data[key] === 'object'){
                form_data[key].push(value);
            }
            else{
                var i1 =  form_data[key];
                form_data[key] = [];
                form_data[key].push(i1);
                form_data[key].push(value);
            }
        }


    });
    return form_data;
}
function get_current_url(){
    return location.origin+location.pathname+'/';
}
function get_name(element){
    return $(element).attr('name');
}
function get_id(element){
    return $(element).attr('id');
}
function reset_form(form_id){
    var inputs = $('#'+form_id+' input');

    for(let i = 0; i<inputs.length ; i++)
    {
        $(inputs[i]).val("");
    }
}
function reinitialize_sweetConfirmCallBack(){
    sweetConfirmCallBackFunction = {
        no:function(){console.log('chosed no')},
        yes:function(){console.log('choosed yes')}
    }
}
function reinitialize_check_uniquityCallBack(){
    check_uniquity_callBackFunction = {
        false:function(){console.log('response :false')},
        true:function(){console.log('response : true')}
    }
}
function sweetConfirm(message , callBack) {
    swal_confirm('Attention !' ,message,callBack)
}
$(document).on('click','.swal-action-btn',{passive:true},function () {
    $('#swall_two').remove();
    reinitialize_sweetConfirmCallBack();
});
function check_uniquity(table , column , value , field_id,message,callBack){
    if(value.trim().length> 5)
    {
        let display = (($('#'+field_id).hasClass('hide-error'))?'dis-none':'dis-block');
        if(typeof callBack !== "object" || typeof callBack == 'undefined')
        {
            callBack = {};
            callBack.false = function () {
                console.log('response:false');
            }

            callBack.true = function () {
                console.log('response:true');
            }
        }

        if(typeof message == 'undefined'){
            message = 'Sorry the value you provided alrady exist';
        }

        $.ajax({
                type:'post',
                url:base_url+'ajax/check_uniquity',
                data:{table:table.trim(),column:column.trim(),value:value.trim()},
                cache:false,
                success:function(response){
                    $('#err_msg_'+field_id).remove();
                    if(response == 'false')
                    {
                        callBack.false();
                        var msg = '<small class="text-danger '+display+'" id="err_msg_'+field_id+'">'+message+'</small>';

                        $('#'+field_id).removeClass('is-valid');
                        $('#'+field_id).addClass('is-invalid');
                        $('#'+field_id).after(msg);
                        $('#'+field_id).focus();

                    }
                    else
                    {
                        callBack.true();
                        $('#'+field_id).removeClass('is-invalid');
                        $('#'+field_id).addClass('is-valid');
                        $('#err_msg_'+field_id).remove();
                    }
                }
    });
    }
    if(value.trim().length === 0)
    {
        $('#'+field_id).removeClass('is-invalid');
        $('#err_msg_'+field_id).remove();
    }

}
function check_uniquity_multi_col(table, value , conditions , field_id, message ,callBack){

    let display = (($('#'+field_id).hasClass('hide-error'))?'dis-none':'dis-block');

    if(value.trim().length>= 3)
    {
        if(typeof callBack !== "object")
        {
            callBack.false = console.log('response:false');

            callBack.true = console.log('response:true')
        }

        if(typeof message == 'undefined'){ message = 'Sorry the value you provided alrady exist'; }

        $.ajax({
                type:'post',
                url:base_url+'check_uniquity_multi_col',
                data:{table:table.trim(),conditions:conditions,value:value.trim()},
                cache:false,
                success:function(response){
                $('#err_msg_'+field_id).remove();
                if(response == 'false')
                {
                    callBack.false();
                    var msg = '<small class="text-danger '+display+'" id="err_msg_'+field_id+'">'+message+'</small>';
                    $('#'+field_id).removeClass('is-valid');
                    $('#'+field_id).addClass('is-invalid');
                    $('#'+field_id).after(msg);
                    $('#'+field_id).focus();
                }
                else
                {
                    callBack.true();
                    $('#'+field_id).removeClass('is-invalid');
                    $('#'+field_id).addClass('is-valid');
                    $('#err_msg_'+field_id).remove();
                }
            },
        });

        reinitialize_check_uniquityCallBack();
    }
    else{
        $('#'+field_id).removeClass('is-invalid');
        $('#err_msg_'+field_id).remove();
    }

}
function closeModal(){
    $('[data-dismiss="modal"]').click();
    $('.swal-overlay').remove();
}
function sweetModal(params){
    hide_loader();
    params = params || {};
    var param = {};
    param.html = params.html || '';
    param.title = params.title || '';
    param.size = params.size || 'auto';

    $('#sweetModalBody').html(param.html);
    $('#sweetModalTitle').html(param.title);
    $('#sweetModalDialog').attr('style','max-width:'+param.size+'; width: '+param.size+'');

    $('[data-target="#SweetModal"]').click();
}
//=====================================================
//==================== SWAL ===========================

function show_loader(message){
    if(typeof message === 'undefined'){
        Swal.showLoading();
    }
    else{
        Swal.fire({html:message});
        Swal.showLoading();
    }

}
function hide_loader(){
    Swal.close()
}
function swal_confirm(title , message ,callback , btn_options){
    var btn_opt = {};
    btn_options = btn_options || {};
    btn_opt.showCancelButton = btn_options.showCancelButton || true;
    btn_opt.confirmButtonText = btn_options.confirmButtonText || 'Oui';
    btn_opt.cancelButtonText = btn_options.cancelButtonText || 'Non';

    var cb = {};
    callback = callback || {};

    cb.yes = callback.yes || function () { console.log('chosed yes')};
    cb.no  = callback.no  || function () { console.log('chosed no') ;
        if(typeof custom_btn_by_id !== 'undefined'){ reset_btn_state(); swal.close(); }
    };

    Swal.fire({
        title: title,
        text: message,
        icon: 'question',
        showCancelButton: btn_opt.showCancelButton,
        confirmButtonText: btn_opt.confirmButtonText,
        cancelButtonText: btn_opt.cancelButtonText,
        allowOutsideClick:function () {
            //reset switch state if no choise is made
            if(typeof custom_btn_by_id !== 'undefined'){
                reset_btn_state();
                swal.close();
            }
        }
    }).then((result) => {
        if (result.value) {
            cb.yes();
        } else if (result.dismiss === Swal.DismissReason.cancel) {
            cb.no();
        }
    })
}
function swal_message(title , message , icon , timer){
    Swal.fire({
        title: title,
        text: message,
        icon: icon,
        cancelButtonText: 'Ok',
        timer: timer || 2000
    })
}
function show_message(notif_type , message , time , position) {
    message = message || 'message';
    notif_type = notif_type || 'success';
    time = time || 3000;
    position = position || 'top-end';

    const Toast = Swal.mixin({
        toast: true,
        position: position,
        showConfirmButton: false,
        timer: time,
        timerProgressBar: true,
        onOpen: (toast) => {
            toast.addEventListener('mouseenter', Swal.stopTimer)
            toast.addEventListener('mouseleave', Swal.resumeTimer)
        }
    })

    Toast.fire({
        icon: notif_type,
        title: message
    })
}
function sweetDialog(html, params){
    params = params || {};
    var prm = {};

    if(typeof params.showCancelButton !== 'undefined'){
        prm.showCancelButton = params.showCancelButton;
    }
    prm.title = params.title || '';
    prm.size  = params.size  || 600;
    prm.cancelButtonText = params.cancelButtonText || 'Fermer';
    prm.showCloseButton =  params.showCloseButton  || 'true';
    prm.allowOutsideClick =  params.allowOutsideClick  || 'true';

    prm.showCloseButton = ((prm.showCloseButton === 'true')?true : false)
    prm.allowOutsideClick = ((prm.allowOutsideClick === 'true')?true : false)

    Swal.fire({
        title: prm.title,
        html : html,
        width: prm.size,
        allowOutsideClick:prm.allowOutsideClick,
        showCancelButton: prm.showCancelButton,
        showConfirmButton:false,
        cancelButtonText: prm.cancelButtonText,
        reverseButtons: true,
        padding: '3em',
        backdrop: 'rgba(0,0,123,0.4)',
        showCloseButton:prm.showCloseButton,
    })
}

function close_modal(){
    closeModal();
}
function refresh() {
    location.href = location.origin+location.pathname;
}
function reset_btn_state(){
    custom_btn_by_id.prop('checked',(custom_btn_by_id.prop('checked') === true)?false : true);
}
function scrool_to(element_id){
    $('html , body , .ps-container').animate({scrollTop:$('#'+element_id+'').offset().top} , 300);
}
function scrool_within_to(container_id,element_id){
    $('#'+container_id).animate({scrollTop:$('#'+element_id+'').offset().top} , 300);
}
function validateEmail(email) {
    var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
    return re.test(String(email).toLowerCase());
}
function validate_form(form_id , show_error){
    show_error = show_error || 'true';

    show_error = show_error === 'true';

    required_fields = $('#'+form_id+' *[required]');

    var the_form_id = form_id+'';

    for(var i = 0 ; i < required_fields.length ; i++){

        var field = $(required_fields[i]);

        if(field.attr('type') != 'hidden' && field.attr('type') != 'file')
        {
            field.keyup();
            if(field.val().trim().length>0)
            {
                var is_valid_field = '<small id="chk_field_'+i+'"><i class="text-success fas fa-check check"></i></small>';
                $('#chk_field_'+i).remove();
                field.removeClass('is-invalid');
                field.addClass('is-valid');
            }
            else
            {
                var is_invalid_field = '<small id="chk_field_'+i+'"><i class="text-danger fas fa-times check"></i></small>';
                $('#chk_field_'+i).remove();
                field.removeClass('is-valid');
                field.addClass('is-invalid');
            }

            if(field.attr('type') === 'checkbox'){
                if(field.hasClass('terms_condition'))
                {
                    if($('[type="checkbox"]').prop('checked') === false)
                    {
                        let msgg = '<div id="term_cond_msg"><small class="text-danger small">You must agree with our terms of usage and conditions</small></div>';
                        field.removeClass('is-valid');
                        field.addClass('is-invalid');
                        field.parent().after(msgg);
                    }
                    else
                    {
                        field.removeClass('is-invalid');
                        field.addClass('is-valid');
                        $('#term_cond_msg').remove();
                    }
                }
            }
        }

    }

    // $('#strip_pay_stat').attr('class','');
    //

    total_error = $('#'+the_form_id+' .is-invalid , #'+the_form_id+' .text-danger').length;

    console.log('total-invalid field = '+total_error);

    if(total_error > 0)
    {
        if(show_error) show_error_message('You must correctly fill the form to proceed !');

        return false;
    }
    else
    {
        return true
    }


}
function show_error_message(error_msg , footer){
    footer = footer || '';
    sweetAlertTwo({
        icon: 'error',
        title: 'Oops...',
        html: error_msg,
        footer: footer
    })
}
function check_new_image(){
    console.log('checking new image')
    if(active_upload != null && active_upload_id != null){
        var preview_area = $('[data-upload-id="'+active_upload_id+'"] .custom-file-container__image-preview');
        var control_area = $('[data-upload-id="'+active_upload_id+'"] .upload-file-controlls');
        var input_file   = $('[data-upload-id="'+active_upload_id+'"] #customFile');
        var submit_button= $('#'+$('[data-upload-id="'+active_upload_id+'"]').attr('data-submit-btn-id')+'');
        var nex_button   = $('#next_button');
        if(!preview_area.hasClass('multiple-file')){
            setTimeout(function () {
                if(active_upload.selectedFilesCount>0){
                    control_area.show('slow');
                    submit_button.show('slow');
                    input_file.removeClass('is-invalid');
                    input_file.addClass('is-valid');
                    if(typeof nex_button.html() !== 'undefined'){
                        nex_button.removeAttr('disabled');
                        nex_button.show('slow');
                    }

                }
                else{
                    control_area.hide('slow');
                    submit_button.hide('slow');
                    if(typeof nex_button.html() !== 'undefined'){
                        nex_button.attr('disabled','disabled');
                        nex_button.hide('slow');
                    }

                    input_file.removeClass('is-valid');
                    input_file.addClass('is-invalid');
                }

                console.log('total_image : '+upload.selectedFilesCount)
            },100)
        }
    }
}
function get_input_height(input_element){
    if(typeof input_element !== 'undefined'){
        return input_element.clientHeight;
    }
}
function get_input_width(input_element){
    if(typeof input_element !== 'undefined'){
        return input_element.clientWidth;
    }
}
function copy_text(field_or_field_selector , message){

    if(message === undefined){
        message = 'text successfully copied';
    }

    if(field_or_field_selector !== undefined){
        var tag = null;
        if(typeof field_or_field_selector === 'object'){
            tag = field_or_field_selector;
        }

        else if (typeof field_or_field_selector === 'string'){
            tag = $(field_or_field_selector);
        }

        if(tag !== null){
            tag.select();
            document.execCommand("copy");
            show_message('info', message);
        }
    }
}
function limit_string(string , max_length){
    if(string !== undefined && max_length!== undefined){
        string = string.trim();
        var str = '';
        for(var i = 0 ; i<max_length ; i++){

            if(typeof string[i] !== 'undefined'){
                str+= string[i];
            }

        }

        if(string.length > max_length){
            return str+='...';
        }
        else{
            return str;
        }

    }
}
function sweetAlertTwo(params){

    $('#sweetAlertTow').remove();

    params = params || {};

    var defaultParams = {
        title: params.title || '',
        titleText: '',
        text: '',
        html: params.html || '',
        footer: '',
        icon: params.icon || undefined,
        iconHtml: undefined,
        toast: false,
        animation: true,
        showClass: {
            popup: 'swal2-show',
            backdrop: 'swal2-backdrop-show',
            icon: 'swal2-icon-show'
        },
        hideClass: {
            popup: 'swal2-hide',
            backdrop: 'swal2-backdrop-hide',
            icon: 'swal2-icon-hide'
        },
        customClass: undefined,
        target:params.target || 'body',
        backdrop:(params.backdrop !== undefined)?params.backdrop:true,
        heightAuto:(params.heightAuto !== undefined)?params.heightAuto:true,
        allowOutsideClick:(params.allowOutsideClick !== undefined)?params.allowOutsideClick:true,
        allowEscapeKey:(params.allowEscapeKey !== undefined)?params.allowEscapeKey:true,
        allowEnterKey:(params.allowEnterKey !== undefined)?params.allowEnterKey:true,
        stopKeydownPropagation:(params.stopKeydownPropagation !== undefined)?params.stopKeydownPropagation:true,
        keydownListenerCapture:(params.keydownListenerCapture !== undefined)?params.keydownListenerCapture:false,
        showConfirmButton:(params.showConfirmButton !== undefined)?params.showConfirmButton : true,
        showCancelButton:(params.showCancelButton !== undefined)?params.showCancelButton:false,
        preConfirm:params.preConfirm || undefined,
        confirmButtonText:params.confirmButtonText || params.confirmButtonText ||'OK',
        confirmButtonAriaLabel:params.confirmButtonAriaLabel || '',
        confirmButtonColor:params.confirmButtonColor || undefined,
        cancelButtonText:params.cancelButtonText || 'Cancel',
        cancelButtonAriaLabel:params.cancelButtonAriaLabel || '',
        cancelButtonColor:params.cancelButtonColor || undefined,
        buttonsStyling:(params.buttonsStyling !== undefined)?params.buttonsStyling:true,
        reverseButtons:(params.reverseButtons !== undefined)?params.reverseButtons:false,
        focusConfirm:(params.focusConfirm !== undefined)?params.focusConfirm:true,
        focusCancel:(params.focusCancel !== undefined)?params.focusCancel:false,
        showCloseButton:(params.showCloseButton !== undefined)?params.showCloseButton:false,
        closeButtonHtml:params.closeButtonHtml || '&times;',
        closeButtonAriaLabel:params.closeButtonAriaLabel || 'Close this dialog',
        showLoaderOnConfirm:(params.showLoaderOnConfirm !== undefined)?params.showLoaderOnConfirm:false,
        imageUrl:params.imageUrl || undefined,
        imageWidth:params.imageWidth || undefined,
        imageHeight:params.imageHeight || undefined,
        imageAlt:params.imageAlt || '',
        timer:params.timer || undefined,
        timerProgressBar:(params.timerProgressBar !== undefined)?params.timerProgressBar:false,
        width:params.width || undefined,
        padding:params.padding || undefined,
        background:params.background || undefined,
        input:params.input || undefined,
        inputPlaceholder:params.inputPlaceholder || '',
        inputValue:params.inputValue || '',
        inputOptions:params.inputOptions || {},
        inputAutoTrim:(params.inputAutoTrim !== undefined)?params.inputAutoTrim:true,
        inputAttributes:params.inputAttributes || {},
        inputValidator:params.inputValidator || undefined,
        validationMessage:params.validationMessage || undefined,
        grow:(params.grow !== undefined)?params.grow:false,
        position:params.position || 'center',
        progressSteps:params.progressSteps || [],
        currentProgressStep:params.currentProgressStep || undefined,
        progressStepsDistance:params.progressStepsDistance || undefined,
        onBeforeOpen:params.onBeforeOpen || undefined,
        onOpen:params.onOpen || undefined,
        onRender:params.onRender || undefined,
        onClose:params.onClose || undefined,
        onAfterClose:params.onAfterClose || undefined,
        onDestroy:params.onDestroy || undefined,
        scrollbarPadding:(params.scrollbarPadding !== undefined)?params.scrollbarPadding:true
    };

    var show_icon = {
        error:'display:none',
        info:'display:none',
        question:'display:none',
        warning:'display:none',
        success:'display:none',
    };

    switch(defaultParams.icon){
        case 'error':show_icon.error = 'display:flex';break;
        case 'info':show_icon.info = 'display:flex';break;
        case 'question':show_icon.question = 'display:flex';break;
        case 'success':show_icon.success = 'display:flex';break;
    }

    var show = {
        html: 'display:block',
        title: ((defaultParams.title.length > 0)?'display:flex':'display:none')
    };



    var html = '<div class="swal2-container swal2-center swal2-backdrop-show" id="sweetAlertTow" style="overflow-y: auto;">'+
        '<div aria-labelledby="swal2-title" aria-describedby="swal2-content" class="swal2-popup swal2-modal swal2-show" tabindex="-1" role="dialog" aria-live="assertive" aria-modal="true" style="display: flex;">'+
        '<div class="swal2-header">'+
        '<ul class="swal2-progress-steps" style="display: none;"></ul>'+
        '<div class="swal2-icon swal2-error" style="'+show_icon.error+'"><span class="swal2-x-mark"> <span class="swal2-x-mark-line-left"></span> <span class="swal2-x-mark-line-right"></span> </span></div>'+
        '<div class="swal2-icon swal2-question" style="'+show_icon.question+'"></div>'+
        '<div class="swal2-icon swal2-warning" style="'+show_icon.warning+'"></div>'+
        '<div class="swal2-icon swal2-info" style="'+show_icon.info+'"><div class="swal2-icon-content">i</div></div>'+
        '<div class="swal2-icon swal2-success" style="'+show_icon.success+'"></div>'+
        '<img class="swal2-image" style="display: none;">'+
        '<h2 class="swal2-title" id="swal2-title" style="'+show.title+'">'+defaultParams.title+'</h2>'+
        '<button type="button" class="swal2-close" onclick="closeSwallTwo();" aria-label="Close this dialog" style="display: flex;">Ã—</button>'+
        '</div>'+
        '<div class="swal2-content">'+
        '<div id="swal2-content" class="swal2-html-container" style="'+show.html+'">'+defaultParams.html+'</div>'+
        '<input class="swal2-input" style="display: none;"><input type="file" class="swal2-file" style="display: none;">'+
        '<div class="swal2-range" style="display: none;"><input type="range">'+
        '<output></output>'+
        '</div>'+
        '<select class="swal2-select" style="display: none;"></select>'+
        '<div class="swal2-radio" style="display: none;"></div>'+
        '<label for="swal2-checkbox" class="swal2-checkbox" style="display: none;"><input type="checkbox"><span class="swal2-label"></span></label><textarea class="swal2-textarea" style="display: none;"></textarea>'+
        '<div class="swal2-validation-message" id="swal2-validation-message"></div>'+
        '</div>'+
        '<div class="swal2-actions">'+
        '<button onclick="closeSwallTwo();" type="button" class="swal2-confirm swal2-styled" aria-label="" style="display: '+((defaultParams.showConfirmButton === true )?'inlinr-block':'none')+'; border-left-color: rgb(48, 133, 214); border-right-color: rgb(48, 133, 214);">'+
        'OK'+
        '</button>'+
        '<button type="button" class="swal2-cancel swal2-styled" aria-label="" style="display: none;">Cancel</button>'+
        '</div>'+
        '<div class="swal2-footer" style="display: none;"></div>'+
        '<div class="swal2-timer-progress-bar" style="display: none;"></div>'+
        '</div>'+
        '</div>';
    $('body').after(html);
    $('body').addClass('pace-done swal2-shown swal2-height-auto');
    $('#swall_two').show('slow');
}
function closeSwallTwo(){
    if(swallTowAutoClose){
        $('#sweetAlertTow').remove();

    }
}
function showSwal2Loading(){
    sweetDialog(loader);
}
function hideSwal2Loading(){
    const btn = $('#swal2-confirm-btn');
    $(btn).removeClass('swal2-loading');
    $(btn).attr('onclick','closeSwallTwo();');
}
function simulate_items_click(id){
    $('#'+id).click();
}
function write_text(input_id){
    $('#t_'+input_id).text($('#'+input_id).val()+"");
}
function set_flashdata(key , value){
    localStorage.setItem(key , value);
}
function get_flashdata(key){
    var data = localStorage.getItem(key);
    localStorage.removeItem(key);
    return data;
}
function windowPopupCenter (url, title, w, h) {
    w = w || 580;
    h = h || 470;
    // Fixes dual-screen position                         Most browsers      Firefox
    var dualScreenLeft = window.screenLeft !== undefined ? window.screenLeft : screen.left;
    var dualScreenTop = window.screenTop !== undefined ? window.screenTop : screen.top;

    var width = window.innerWidth ? window.innerWidth : document.documentElement.clientWidth ? document.documentElement.clientWidth : screen.width;
    var height = window.innerHeight ? window.innerHeight : document.documentElement.clientHeight ? document.documentElement.clientHeight : screen.height;

    var left = ((width / 2) - (w / 2)) + dualScreenLeft;
    var top = ((height / 3) - (h / 3)) + dualScreenTop;

    var newWindow = window.open(url, title, 'scrollbars=yes, width=' + w + ', height=' + h + ', top=' + top + ', left=' + left);

    // Puts focus on the newWindow
    if (newWindow && newWindow.focus) {
        newWindow.focus();
    }
};
$(document).on('click','.preview',{passive:true},function () {
    var picture = $(this).attr('src');
    var image = '<img src="'+picture+'" id="user_pic_here" alt="" alt="user picture" style="max-width:100%">';
    sweetDialog(image,{showConfirmButton:false});
});

$(document).on('click','.preview_document',{passive:true},function () {
    var picture = $(this).attr('src');
    var image = '<img src="'+picture+'" id="user_pic_here" alt="" alt="user picture" style="max-width:100%">';
    sweetAlertTwo({html:image,showConfirmButton:false,allowOutsideClick:true})

});

$(document).on('click','.swal2-container , .swal2-backdrop-show',{passive:true},function () {
    closeSwallTwo();
});
function get_current_link2(){
    return get_current_url().substring(0 , (get_current_url().length) - 1);
}

function enable_tooltip(){
    $('[data-toggle="tooltip"]').tooltip();
}

function show_file_chooser(form_action_url , params) {

    params = params || {};
    var param = {};

    param.img_src = params.img_src || base_url+'upload/images/empty_box.png';
    param.uploadBtnTitle = params.uploadBtnTitle || 'Upload a picture';



    var html = '<form action="'+form_action_url+'" method="post" enctype="multipart/form-data">\n'+
    '<div class="text-center custom-file-upload">'+
    '    <div class="wrapper-image-preview dis-inline-block">'+
    '        <div id="file_preview_box" class="image-box" style="width: 250px;">'+
    '            <div class="js--image-preview" style="background-image: url('+param.img_src+'); background-color: #F5F5F5;"></div>'+
    '            <div class="upload-options">'+
    '                <label for="header_logo" class="btn btn-block btn-white"> <i class="mdi mdi-camera"></i>'+param.uploadBtnTitle+'</label>'+
    '                <input id="header_logo" required style="visibility:hidden; height: 1px;" type="file" class="image-upload" name="user_file" accept="image/*">' +
    '               <button type="submit" class="btn btn-dark">Upload</button>' +
    '            </div>'+
    '        </div>'+
    '    </div>' +
    '</div>'+
    '</form>';

    sweetDialog(html,{});

    setTimeout(function () {
        const box = $('.image-box');
        initImageUpload(box[0]);
    },500)
}
//Form Submition
function ajaxSubmit(e, form, callBackFunction) {
    function default_function(){}
    callBackFunction = callBackFunction || default_function();
    const form_id = $(form).attr('id');
    if(validate_form(form_id , 'false')) {
        e.preventDefault();
        const action = form.attr('action');
        const form2 = e.target;
        var data = new FormData(form2);
        data[site.csrf_token] = site.csrf_token_value;
        $.ajax({
            type: "POST",
            url: action,
            processData: false,
            contentType: false,
            data: data,
            success: function(response)
            {
                console.log(response.message);
                if (response.status === true) {
                    show_message('success',response.message);
                    if(typeof callBackFunction !== 'undefined'){
                        callBackFunction(response);
                    }
                }
                else{
                    show_message('error',response.message);
                }
                ajax_submit_form_callback = function(){
                    console.log('default callback');
                }
            },
            error:function () {
                show_message('error','An error Occurred! Please try again')
            }
        });
    }else {
        show_message('error','Please make sure to fill all the necessary fields')
    }
}

function get_form_data(e , form){
    const action = form.attr('action');
    const form2 = e.target;
    const data = new FormData(form2);
    return data;
}

function remove_tag(tag){
    if(typeof tag !== 'undefined'){
        $(tag).hide('slow');
        setTimeout(function () {
            $(tag).remove();
        },1000)
    }
}

function init_image_boxes(){
    var boxes = document.querySelectorAll('.image-box');

    if(boxes.length > 0){
        for (let i = 0; i < boxes.length; i++) {
            let box = boxes[i];
            //initDropEffect(box);
            initImageUpload(box);
        }
    }

}

function init_select2() {
    const ids = $('.select2');
    if(ids.length > 0){
        for(i = 0; i < ids.length; i++){
            $(ids[i]).select2();
        }
    }
}

function initImageUpload(box) {
    let uploadField = box.querySelector('.image-upload');

    uploadField.addEventListener('change', getFile);

    function getFile(e){
        let file = e.currentTarget.files[0];
        checkType(file);
    }

    function previewImage(file){
        let thumb = box.querySelector('.js--image-preview'),
            reader = new FileReader();
        reader.onload = function() {
            thumb.style.backgroundImage = 'url(' + reader.result + ')';
        }
        reader.readAsDataURL(file);
        thumb.className += ' js--no-default';
    }

    function checkType(file){
        let imageType = /image.*/;
        if (!file.type.match(imageType)) {
            throw 'Datei ist kein Bild';
        } else if (!file){
            throw 'Kein Bild gewÃ¤hlt';
        } else {
            previewImage(file);
        }
    }

}


function check_empty_table(){
    const empty_tables = $('.dataTables_wrapper .dataTables_empty');
    for(i = 0; i < empty_tables.length; i++){
        $(empty_tables[i]).parents('.dataTables_wrapper').html('<h3 class="text-center">No record found !</h3>');
    }
}

function update_sidebar_color(value){
    $.post(base_url+'admin/dashboard/update_setting',{'setting_key':'sidebar_menu_color' , 'value':value , 'token':site.csrf_token_value},function () {
        setTimeout(function () {
            show_message('success','setting successfully updated');
        },500);

    })
}
function update_sidebar_bg(value){
    $(sidebar_tag).attr('data-background-color',value);
    $.post(base_url+'admin/dashboard/update_setting',{'setting_key':'sidebar_bg_color' , 'value':value.trim() , 'token':site.csrf_token_value},function () {
        setTimeout(function () {
            show_message('success','setting successfully updated');
        },500);

    })
}
function update_sidebar_img(value){
    $.post(base_url+'admin/dashboard/update_setting',{'setting_key':'sidebar_bg_img' , 'value':value.trim() , 'token':site.csrf_token_value},function () {
        setTimeout(function () {
            show_message('success','setting successfully updated');
        },500);

    })
}
function scrollToTop(){
    const tag =  $('html , body');
    tag.removeClass('perfect-scrollbar-on');
    tag.animate({scrollTop:0} , 300);
    setTimeout(function () {
        tag.addClass('perfect-scrollbar-on');
    },400)
}
function sweetModal1(params){
    hide_loader();
    params = params || {};
    var param = {};
    param.html = params.html || '';
    param.title = params.title || '';
    param.size = params.size || 'auto';
    param.top = params.top || '40px';

    $('#SweetModal1 #sweetModalBody').html(param.html);
    $('#SweetModal1 #sweetModalTitle').html(param.title);
    if(param.size !== 'auto'){
        $('#SweetModal1 #sweetModalDialog').attr('style','width:'+param.size+';max-width:'+param.size+'');
        $('#SweetModal1 .modal-content').css('top' , ''+param.top+'');
    }

    $('[href="#SweetModal1"]').click();
}
function sweetModal2(params){
    hide_loader();
    params = params || {};
    var param = {};
    param.html = params.html || '';
    param.title = params.title || '';
    param.size = params.size || 'auto';

    $('#SweetModal2 #sweetModalBody').html(param.html);
    $('#SweetModal2 #sweetModalTitle').html(param.title);
    if(param.size !== 'auto'){
        $('#SweetModal2 #sweetModalDialog').attr('style','width:'+param.size+';max-width:'+param.size+'');
    }

    $('[href="#SweetModal2"]').click();
}
function sweetModal3(params){
    hide_loader();
    params = params || {};
    var param = {};
    param.html = params.html || '';
    param.title = params.title || '';
    param.size = params.size || 'auto';

    $('#SweetModal3 #sweetModalBody').html(param.html);
    $('#SweetModal3 #sweetModalTitle').html(param.title);
    if(param.size !== 'auto'){
        $('#SweetModal3 #sweetModalDialog').attr('style','width:'+param.size+';max-width:'+param.size+'');
    }

    $('[href="#SweetModal3"]').click();
}
function sweetModal4(params){
    hide_loader();
    params = params || {};
    var param = {};
    param.html = params.html || '';
    param.title = params.title || '';
    param.size = params.size || 'auto';

    $('#SweetModal4 #sweetModalBody').html(param.html);
    $('#SweetModal4 #sweetModalTitle').html(param.title);
    if(param.size !== 'auto'){
        var old_style= $('#SweetModal4 #sweetModalDialog').attr('style');
        $('#SweetModal4 #sweetModalDialog').attr('style',''+old_style+' width:'+param.size+';max-width:'+param.size+'');
    }

    $('[href="#SweetModal4"]').click();
}

function close_modal1(){ $('.close_modal1').click(); }
function close_modal2(){ $('.close_modal2').click(); }
function close_modal3(){ $('.close_modal3').click(); }
function close_modal4(){ $('.close_modal4').click(); }
function rightModal(url, header , size){
    size = size || 'auto';
    show_loader();
    $.post(url,{'token':site.csrf_token_value},function (response) {
        hide_loader();
        sweetModal4({html:response, title:header, size:size});
        setTimeout(function(){
            initDataTable('datatable');
        },300);
    });
}
function confirmModal(delete_url, param){
    jQuery('#alert-modal').modal('show', {backdrop: 'static'});
    callBackFunction = param;
    document.getElementById('delete_form').setAttribute('action' , delete_url);
}
function initDataTable(tableId) {
    init_datatable('#'+tableId+'');
}


